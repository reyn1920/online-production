<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Niche Domination - TRAE.AI Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <link href="{{ url_for('static', filename='css/dashboard.css') }}" rel="stylesheet"/>
    <style>
      .niche-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 15px;
        color: white;
        transition: transform 0.3s ease;
      }
      .niche-card:hover {
        transform: translateY(-5px);
      }
      .expansion-opportunity {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 15px;
        color: white;
      }
      .growth-metric {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        color: white;
      }
      .strategy-card {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        border-radius: 10px;
        padding: 20px;
        color: white;
      }
      .progress-ring {
        transform: rotate(-90deg);
      }
      .progress-ring-circle {
        stroke-dasharray: 251.2;
        stroke-dashoffset: 251.2;
        transition: stroke-dashoffset 0.35s;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">
          <i class="fas fa-robot me-2"></i>
          TRAE.AI Dashboard
        </a>
        <div class="navbar-nav ms-auto">
          <a class="nav-link" href="/">Dashboard</a>
          <a class="nav-link" href="/agents">Agents</a>
          <a class="nav-link" href="/tasks">Tasks</a>
          <a class="nav-link active" href="/niche-domination">Niche Domination</a>
        </div>
      </div>
    </nav>

    <div class="container-fluid mt-4">
      <div class="row">
        <div class="col-12">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>
              <i class="fas fa-chart-line me-2"></i>
              Niche Domination Center
            </h1>
            <button class="btn btn-primary" onclick="refreshDashboard()">
              <i class="fas fa-sync-alt me-2"></i>
              Refresh
            </button>
          </div>
        </div>
      </div>

      <!-- Growth Metrics Overview -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="growth-metric">
            <h5>
              <i class="fas fa-users"></i>
              Total Reach
            </h5>
            <h2 id="totalReach">0</h2>
            <small>
              +
              <span id="reachGrowth">0</span>
              % this month
            </small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="growth-metric">
            <h5>
              <i class="fas fa-eye"></i>
              Engagement Rate
            </h5>
            <h2 id="engagementRate">0%</h2>
            <small>
              +
              <span id="engagementGrowth">0</span>
              % this month
            </small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="growth-metric">
            <h5>
              <i class="fas fa-dollar-sign"></i>
              Revenue Growth
            </h5>
            <h2 id="revenueGrowth">0%</h2>
            <small>
              +
              <span id="revenueChange">0</span>
              % this month
            </small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="growth-metric">
            <h5>
              <i class="fas fa-bullseye"></i>
              Market Share
            </h5>
            <h2 id="marketShare">0%</h2>
            <small>
              +
              <span id="shareGrowth">0</span>
              % this month
            </small>
          </div>
        </div>
      </div>

      <!-- Current Niches and Expansion Opportunities -->
      <div class="row">
        <div class="col-md-8">
          <div class="card">
            <div class="card-header">
              <h5>
                <i class="fas fa-crosshairs me-2"></i>
                Current Niches & Performance
              </h5>
            </div>
            <div class="card-body">
              <div id="currentNiches" class="row">
                <!-- Current niches will be populated here -->
              </div>
            </div>
          </div>

          <div class="card mt-4">
            <div class="card-header">
              <h5>
                <i class="fas fa-rocket me-2"></i>
                Expansion Opportunities
              </h5>
            </div>
            <div class="card-body">
              <div id="expansionOpportunities">
                <!-- Expansion opportunities will be populated here -->
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card">
            <div class="card-header">
              <h5>
                <i class="fas fa-chess me-2"></i>
                Strategic Actions
              </h5>
            </div>
            <div class="card-body">
              <div class="strategy-card mb-3">
                <h6>
                  <i class="fas fa-search"></i>
                  Market Analysis
                </h6>
                <p>Analyze competitor strategies and market gaps</p>
                <button class="btn btn-light btn-sm" onclick="runMarketAnalysis()">
                  <i class="fas fa-play"></i>
                  Run Analysis
                </button>
              </div>

              <div class="strategy-card mb-3">
                <h6>
                  <i class="fas fa-expand-arrows-alt"></i>
                  Niche Expansion
                </h6>
                <p>Identify and expand into profitable niches</p>
                <button class="btn btn-light btn-sm" onclick="showExpansionModal()">
                  <i class="fas fa-plus"></i>
                  Plan Expansion
                </button>
              </div>

              <div class="strategy-card mb-3">
                <h6>
                  <i class="fas fa-bolt"></i>
                  Day One Blitz
                </h6>
                <p>Execute rapid market penetration strategy</p>
                <button class="btn btn-light btn-sm" onclick="initiateBlitz()">
                  <i class="fas fa-lightning-bolt"></i>
                  Launch Blitz
                </button>
              </div>

              <div class="strategy-card">
                <h6>
                  <i class="fas fa-chart-bar"></i>
                  Performance Review
                </h6>
                <p>Analyze current niche performance metrics</p>
                <button class="btn btn-light btn-sm" onclick="generateReport()">
                  <i class="fas fa-file-alt"></i>
                  Generate Report
                </button>
              </div>
            </div>
          </div>

          <div class="card mt-4">
            <div class="card-header">
              <h5>
                <i class="fas fa-cogs me-2"></i>
                Automation Status
              </h5>
            </div>
            <div class="card-body">
              <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" id="autoExpansion" checked/>
                <label class="form-check-label" for="autoExpansion">Auto Niche Expansion</label>
              </div>
              <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" id="competitorMonitoring" checked/>
                <label class="form-check-label" for="competitorMonitoring">Competitor Monitoring</label>
              </div>
              <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" id="marketAlerts" checked/>
                <label class="form-check-label" for="marketAlerts">Market Opportunity Alerts</label>
              </div>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="autoOptimization" checked/>
                <label class="form-check-label" for="autoOptimization">Auto Performance Optimization</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Expansion Planning Modal -->
    <div class="modal fade" id="expansionModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-expand-arrows-alt me-2"></i>
              Plan Niche Expansion
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="expansionForm">
              <div class="mb-3">
                <label for="targetNiche" class="form-label">Target Niche</label>
                <input
                  type="text"
                  class="form-control"
                  id="targetNiche"
                  placeholder="e.g., AI-powered fitness coaching"/>
              </div>
              <div class="mb-3">
                <label for="expansionStrategy" class="form-label">Expansion Strategy</label>
                <select class="form-select" id="expansionStrategy">
                  <option value="gradual">Gradual Market Entry</option>
                  <option value="aggressive">Aggressive Penetration</option>
                  <option value="partnership">Partnership-Based</option>
                  <option value="acquisition">Acquisition Strategy</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="targetAudience" class="form-label">Target Audience</label>
                <textarea
                  class="form-control"
                  id="targetAudience"
                  rows="3"
                  placeholder="Describe your target audience for this niche..."
                ></textarea>
              </div>
              <div class="mb-3">
                <label for="budget" class="form-label">Budget Allocation</label>
                <input type="number" class="form-control" id="budget" placeholder="Enter budget in USD"/>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="submitExpansion()">Launch Expansion</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let dashboardData = {};

      async function loadDashboard() {
        try {
          const response = await fetch("/api/niche-domination/dashboard');
          dashboardData = await response.json();
          updateDashboard();
        } catch (error) {
          console.error('Error loading dashboard:', error);
        }
      }

      function updateDashboard() {//Update metrics
        document.getElementById('totalReach').textContent = formatNumber(dashboardData.total_reach || 0);
        document.getElementById('reachGrowth').textContent = dashboardData.reach_growth || 0;
        document.getElementById('engagementRate').textContent = (dashboardData.engagement_rate || 0) + '%';
        document.getElementById('engagementGrowth').textContent = dashboardData.engagement_growth || 0;
        document.getElementById('revenueGrowth').textContent = (dashboardData.revenue_growth || 0) + '%';
        document.getElementById('revenueChange').textContent = dashboardData.revenue_change || 0;
        document.getElementById('marketShare').textContent = (dashboardData.market_share || 0) + '%';
        document.getElementById('shareGrowth').textContent = dashboardData.share_growth || 0;//Update current niches
        updateCurrentNiches();//Update expansion opportunities
        updateExpansionOpportunities();
      }

      function updateCurrentNiches() {
        const container = document.getElementById('currentNiches');
        const niches = dashboardData.current_niches || [];

        container.innerHTML = niches
          .map(
            niche => `
                <div class="col-md-6 mb-3">
                    <div class="niche-card card h-100">
                        <div class="card-body">
                            <h6><i class="fas fa-bullseye me-2"></i>${niche.name}</h6>
                            <p class="small">${niche.description}</p>
                            <div class="d-flex justify-content-between">
                                <span>Performance: ${niche.performance}%</span>
                                <span>Growth: +${niche.growth}%</span>
                            </div>
                            <div class="progress mt-2">
                                <div class="progress-bar" style="width: ${niche.performance}%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `
          )
          .join('');
      }

      function updateExpansionOpportunities() {
        const container = document.getElementById('expansionOpportunities');
        const opportunities = dashboardData.expansion_opportunities || [];

        container.innerHTML = opportunities
          .map(
            opp => `
                <div class="expansion-opportunity">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6><i class="fas fa-rocket me-2"></i>${opp.niche}</h6>
                            <p class="mb-2">${opp.description}</p>
                            <small><strong>Potential ROI:</strong> ${opp.roi}% | <strong>Risk Level:</strong> ${opp.risk}</small>
                        </div>
                        <button class="btn btn-light btn-sm" onclick="expandToNiche('${opp.niche}')">
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            `
          )
          .join('');
      }

      function formatNumber(num) {
        if (num >= 1000000) {
          return (num/1000000).toFixed(1) + 'M';
        } else if (num >= 1000) {
          return (num/1000).toFixed(1) + 'K';
        }
        return num.toString();
      }

      function refreshDashboard() {
        loadDashboard();
      }

      function runMarketAnalysis() {//Implement market analysis functionality
        alert('Market analysis initiated. Results will be available in the dashboard shortly.');
      }

      function showExpansionModal() {
        new bootstrap.Modal(document.getElementById('expansionModal')).show();
      }

      function initiateBlitz() {
        if (
          confirm(
            'Are you sure you want to initiate a Day One Blitz? This will execute an aggressive market penetration strategy.'
          )
        ) {
          alert('Day One Blitz initiated! Monitor the dashboard for real-time progress.');
        }
      }

      function generateReport() {//Implement report generation
        alert('Performance report is being generated. You will receive it via email shortly.');
      }

      function expandToNiche(niche) {
        document.getElementById('targetNiche').value = niche;
        showExpansionModal();
      }

      async function submitExpansion() {
        const formData = {
          target_niche: document.getElementById('targetNiche').value,
          expansion_strategy: document.getElementById('expansionStrategy').value,
          target_audience: document.getElementById('targetAudience').value,
          budget: document.getElementById('budget').value,
        };

        try {
          const response = await fetch("/api/niche-domination/expand', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
          });

          const result = await response.json();
          if (response.ok) {
            alert('Niche expansion initiated successfully!');
            bootstrap.Modal.getInstance(document.getElementById('expansionModal')).hide();
            loadDashboard();
          } else {
            alert('Error: ' + result.error);
          }
        } catch (error) {
          console.error('Error submitting expansion:', error);
          alert('Error submitting expansion plan.');
        }
      }//Load dashboard on page load
      document.addEventListener('DOMContentLoaded', loadDashboard);//Auto-refresh every 30 seconds
      setInterval(loadDashboard, 30000);
    </script>
  </body>
</html>
