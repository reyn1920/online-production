<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Performance Analytics Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        color: white;
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      }

      .card-header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
      }

      .card-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        font-size: 1.2rem;
      }

      .card-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: #2d3748;
      }

      .overview-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .stat-item {
        text-align: center;
        padding: 15px;
        background: #f7fafc;
        border-radius: 10px;
      }

      .stat-value {
        font-size: 1.8rem;
        font-weight: bold;
        color: #4299e1;
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 0.9rem;
        color: #718096;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .prediction-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .prediction-form {
        margin-bottom: 20px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.9);
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        backdrop-filter: blur(10px);
      }

      .form-group input::placeholder,
      .form-group textarea::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }

      .btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }

      .btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .prediction-result {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px;
        margin-top: 15px;
        backdrop-filter: blur(10px);
      }

      .trend-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #e2e8f0;
      }

      .trend-item:last-child {
        border-bottom: none;
      }

      .trend-metric {
        font-weight: 500;
        color: #2d3748;
      }

      .trend-direction {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .trend-arrow {
        font-size: 1.2rem;
      }

      .trend-increasing {
        color: #48bb78;
      }
      .trend-decreasing {
        color: #f56565;
      }
      .trend-stable {
        color: #4299e1;
      }
      .trend-volatile {
        color: #ed8936;
      }

      .insight-item {
        background: #f7fafc;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
        border-left: 4px solid #4299e1;
      }

      .insight-title {
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 8px;
      }

      .insight-description {
        color: #4a5568;
        margin-bottom: 10px;
        line-height: 1.5;
      }

      .insight-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .action-tag {
        background: #e2e8f0;
        color: #4a5568;
        padding: 4px 8px;
        border-radius: 15px;
        font-size: 0.8rem;
      }

      .priority-high {
        border-left-color: #f56565;
      }
      .priority-medium {
        border-left-color: #ed8936;
      }
      .priority-low {
        border-left-color: #48bb78;
      }

      .chart-container {
        height: 300px;
        background: #f7fafc;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #718096;
        font-style: italic;
      }

      .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px;
        color: #718096;
      }

      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #e2e8f0;
        border-top: 4px solid #4299e1;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .error {
        background: #fed7d7;
        color: #c53030;
        padding: 15px;
        border-radius: 10px;
        margin: 15px 0;
      }

      .success {
        background: #c6f6d5;
        color: #2f855a;
        padding: 15px;
        border-radius: 10px;
        margin: 15px 0;
      }

      .model-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
      }

      .model-item {
        background: #f7fafc;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
      }

      .model-name {
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 8px;
        text-transform: capitalize;
      }

      .model-accuracy {
        font-size: 1.5rem;
        font-weight: bold;
        color: #4299e1;
      }

      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .header h1 {
          font-size: 2rem;
        }

        .dashboard-grid {
          grid-template-columns: 1fr;
        }

        .overview-stats {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>🚀 Performance Analytics Dashboard</h1>
        <p>Advanced predictive content scoring and performance insights</p>
      </div>

      <div class="dashboard-grid">
        <!-- Performance Overview -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white">📊</div>
            <div class="card-title">Performance Overview</div>
          </div>
          <div id="overview-content" class="loading">
            <div class="spinner"></div>
            <span>Loading performance data...</span>
          </div>
        </div>

        <!-- Content Prediction -->
        <div class="card prediction-card">
          <div class="card-header">
            <div class="card-icon" style="background: rgba(255, 255, 255, 0.2); color: white">🔮</div>
            <div class="card-title" style="color: white">Content Performance Prediction</div>
          </div>
          <div class="prediction-form">
            <div class="form-group">
              <label for="content-title">Content Title</label>
              <input type="text" id="content-title" placeholder="Enter your content title..."/>
            </div>
            <div class="form-group">
              <label for="content-description">Description</label>
              <textarea id="content-description" rows="3" placeholder="Brief description of your content..."></textarea>
            </div>
            <div class="form-group">
              <label for="content-duration">Duration (minutes)</label>
              <input type="number" id="content-duration" placeholder="10" min="1" max="120"/>
            </div>
            <div class="form-group">
              <label for="content-tags">Tags (comma-separated)</label>
              <input type="text" id="content-tags" placeholder="AI, tutorial, technology"/>
            </div>
            <button class="btn" onclick="predictPerformance()">🎯 Predict Performance</button>
          </div>
          <div id="prediction-result" style="display: none"></div>
        </div>

        <!-- Performance Trends -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background: linear-gradient(135deg, #48bb78, #38a169); color: white">📈</div>
            <div class="card-title">Performance Trends</div>
          </div>
          <div id="trends-content" class="loading">
            <div class="spinner"></div>
            <span>Analyzing trends...</span>
          </div>
        </div>

        <!-- Performance Insights -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background: linear-gradient(135deg, #ed8936, #dd6b20); color: white">💡</div>
            <div class="card-title">Performance Insights</div>
          </div>
          <div id="insights-content" class="loading">
            <div class="spinner"></div>
            <span>Generating insights...</span>
          </div>
        </div>

        <!-- Model Performance -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background: linear-gradient(135deg, #9f7aea, #805ad5); color: white">🤖</div>
            <div class="card-title">ML Model Performance</div>
          </div>
          <div id="models-content" class="loading">
            <div class="spinner"></div>
            <span>Loading model metrics...</span>
          </div>
        </div>

        <!-- Accuracy History Chart -->
        <div class="card">
          <div class="card-header">
            <div class="card-icon" style="background: linear-gradient(135deg, #4299e1, #3182ce); color: white">📉</div>
            <div class="card-title">Prediction Accuracy History</div>
          </div>
          <div id="accuracy-chart" class="chart-container">Chart visualization would be implemented here</div>
        </div>
      </div>
    </div>

    <script>//Global variables
      let dashboardData = null;//Initialize dashboard
      document.addEventListener('DOMContentLoaded', function () {
        loadDashboardData();
      });//Load dashboard data
      async function loadDashboardData() {
        try {
          const response = await fetch("/api/performance-analytics/dashboard');
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          dashboardData = await response.json();//Update all dashboard sections
          updateOverview(dashboardData.overview);
          updateTrends(dashboardData.trends);
          updateInsights(dashboardData.insights);
          updateModelMetrics(dashboardData.model_metrics);
        } catch (error) {
          console.error('Error loading dashboard data:', error);
          showError('Failed to load dashboard data. Please try again later.');
        }
      }//Update performance overview
      function updateOverview(overview) {
        const content = document.getElementById('overview-content');

        if (!overview) {
          content.innerHTML = '<div class="error">No overview data available</div>';
          return;
        }

        content.innerHTML = `
                <div class="overview-stats">
                    <div class="stat-item">
                        <div class="stat-value">${(overview.avg_engagement_rate * 100).toFixed(1)}%</div>
                        <div class="stat-label">Avg Engagement</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${formatNumber(overview.avg_view_count)}</div>
                        <div class="stat-label">Avg Views</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${Math.round(overview.avg_watch_time)}m</div>
                        <div class="stat-label">Avg Watch Time</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${overview.total_content_30_days}</div>
                        <div class="stat-label">Content (30d)</div>
                    </div>
                </div>
            `;
      }//Update trends
      function updateTrends(trends) {
        const content = document.getElementById('trends-content');

        if (!trends || trends.length === 0) {
          content.innerHTML = '<div class="error">No trend data available</div>';
          return;
        }

        const trendsHtml = trends
          .map(trend => {
            const directionClass = `trend-${trend.trend_direction}`;
            const arrow = getTrendArrow(trend.trend_direction);

            return `
                    <div class="trend-item">
                        <div class="trend-metric">${formatMetricName(trend.metric_type)}</div>
                        <div class="trend-direction ${directionClass}">
                            <span class="trend-arrow">${arrow}</span>
                            <span>${trend.trend_direction}</span>
                        </div>
                    </div>
                `;
          })
          .join('');

        content.innerHTML = trendsHtml;
      }//Update insights
      function updateInsights(insights) {
        const content = document.getElementById('insights-content');

        if (!insights || insights.length === 0) {
          content.innerHTML = '<div class="error">No insights available</div>';
          return;
        }

        const insightsHtml = insights
          .map(insight => {
            const priorityClass = `priority-${insight.priority}`;
            const actionsHtml = insight.recommended_actions
              .map(action => `<span class="action-tag">${action}</span>`)
              .join('');

            return `
                    <div class="insight-item ${priorityClass}">
                        <div class="insight-title">${insight.title}</div>
                        <div class="insight-description">${insight.description}</div>
                        <div class="insight-actions">${actionsHtml}</div>
                    </div>
                `;
          })
          .join('');

        content.innerHTML = insightsHtml;
      }//Update model metrics
      function updateModelMetrics(modelMetrics) {
        const content = document.getElementById('models-content');

        if (!modelMetrics) {
          content.innerHTML = '<div class="error">No model metrics available</div>';
          return;
        }

        const metricsHtml = Object.entries(modelMetrics)
          .map(
            ([metric, data]) => `
                <div class="model-item">
                    <div class="model-name">${formatMetricName(metric)}</div>
                    <div class="model-accuracy">${(data.accuracy * 100).toFixed(1)}%</div>
                </div>
            `
          )
          .join('');

        content.innerHTML = `<div class="model-metrics">${metricsHtml}</div>`;
      }//Predict content performance
      async function predictPerformance() {
        const title = document.getElementById('content-title').value;
        const description = document.getElementById('content-description').value;
        const duration = document.getElementById('content-duration').value;
        const tags = document.getElementById('content-tags').value;

        if (!title.trim()) {
          showError('Please enter a content title');
          return;
        }

        const resultDiv = document.getElementById('prediction-result');
        resultDiv.style.display = 'block';
        resultDiv.innerHTML =
          '<div class="loading"><div class="spinner"></div><span>Predicting performance...</span></div>';

        try {
          const response = await fetch("/api/performance-analytics/predict', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              title: title,
              description: description,
              duration_minutes: parseFloat(duration) || 10,
              tags: tags
                .split(',')
                .map(tag => tag.trim())
                .filter(tag => tag),
              upload_date: new Date().toISOString(),
            }),
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const prediction = await response.json();
          displayPredictionResult(prediction);
        } catch (error) {
          console.error('Prediction error:', error);
          resultDiv.innerHTML = '<div class="error">Failed to predict performance. Please try again.</div>';
        }
      }//Display prediction result
      function displayPredictionResult(prediction) {
        const resultDiv = document.getElementById('prediction-result');

        const confidenceWidth = Math.round(prediction.model_accuracy * 100);

        resultDiv.innerHTML = `
                <div class="prediction-result">
                    <h4 style="margin-bottom: 15px; color: white;">📊 Prediction Results</h4>
                    <div style="margin-bottom: 10px;">
                        <strong>Predicted Engagement Rate:</strong> ${(prediction.predicted_value * 100).toFixed(2)}%
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>Confidence Interval:</strong> ${(prediction.confidence_interval[0] * 100).toFixed(2)}% - ${(prediction.confidence_interval[1] * 100).toFixed(2)}%
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>Model Accuracy:</strong> ${(prediction.model_accuracy * 100).toFixed(1)}%
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>Model Used:</strong> ${prediction.model_used}
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin-top: 15px;">
                        <small><strong>💡 Tip:</strong> Higher engagement rates are typically achieved with optimized titles, quality thumbnails, and strategic timing.</small>
                    </div>
                </div>
            `;
      }//Utility functions
      function formatNumber(num) {
        if (num >= 1000000) {
          return (num/1000000).toFixed(1) + 'M';
        } else if (num >= 1000) {
          return (num/1000).toFixed(1) + 'K';
        }
        return num.toString();
      }

      function formatMetricName(metric) {
        return metric.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
      }

      function getTrendArrow(direction) {
        const arrows = {
          increasing: '↗️',
          decreasing: '↘️',
          stable: '➡️',
          volatile: '↕️',
          seasonal: '🔄',
        };
        return arrows[direction] || '➡️';
      }

      function showError(message) {//Show error in all loading sections
        const loadingSections = document.querySelectorAll('.loading');
        loadingSections.forEach(section => {
          section.innerHTML = `<div class="error">${message}</div>`;
        });
      }//Auto-refresh dashboard every 5 minutes
      setInterval(loadDashboardData, 5 * 60 * 1000);
    </script>
  </body>
</html>
