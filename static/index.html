<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>TRAE.AI Dashboard - Master Control Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <style>
      .dashboard-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem 0;
      }
      .control-panel {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
      }
      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 34px;
      }
      .slider:before {
        position: absolute;
        content: '';
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }
      input:checked + .slider {
        background-color: #2196f3;
      }
      input:checked + .slider:before {
        transform: translateX(26px);
      }
      .category-section {
        margin-bottom: 2rem;
      }
      .toggle-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        margin-bottom: 0.5rem;
        background: white;
      }
      .toggle-info {
        flex-grow: 1;
      }
      .toggle-title {
        font-weight: 600;
        margin-bottom: 0.25rem;
      }
      .toggle-description {
        color: #6c757d;
        font-size: 0.9rem;
      }
      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 0.5rem;
      }
      .status-active {
        background-color: #28a745;
      }
      .status-inactive {
        background-color: #dc3545;
      }
      .master-controls {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        color: white;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 2rem;
      }
    </style>
  </head>
  <body>
    <div class="dashboard-header">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h1>
              <i class="fas fa-robot me-3"></i>
              TRAE.AI Master Control Panel
            </h1>
            <p class="mb-0">Autonomous Content Creation & Monetization System</p>
          </div>
          <div class="col-md-4 text-end">
            <div class="d-flex align-items-center justify-content-end">
              <span class="status-indicator status-active"></span>
              <span>System Online</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container mt-4">
      <!-- Master Controls -->
      <div class="master-controls">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h3>
              <i class="fas fa-power-off me-2"></i>
              Master System Controls
            </h3>
            <p class="mb-0">Global system switches - Use with caution</p>
          </div>
          <div class="col-md-4">
            <div class="d-flex justify-content-end gap-3">
              <div class="text-center">
                <label class="toggle-switch">
                  <input type="checkbox" id="go_live" onchange="updateMasterToggle('go_live', this.checked)"/>
                  <span class="slider"></span>
                </label>
                <div class="mt-2"><small>Go Live</small></div>
              </div>
              <div class="text-center">
                <label class="toggle-switch">
                  <input
                    type="checkbox"
                    id="master_automation"
                    onchange="updateMasterToggle('master_automation', this.checked)"/>
                  <span class="slider"></span>
                </label>
                <div class="mt-2"><small>Master Automation</small></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Navigation Tabs -->
      <ul class="nav nav-tabs" id="controlTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="channels-tab"
            data-bs-toggle="tab"
            data-bs-target="#channels"
            type="button"
            role="tab"
          >
            <i class="fas fa-broadcast-tower me-2"></i>
            Channels
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="monetization-tab"
            data-bs-toggle="tab"
            data-bs-target="#monetization"
            type="button"
            role="tab"
          >
            <i class="fas fa-dollar-sign me-2"></i>
            Monetization
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="syndication-tab"
            data-bs-toggle="tab"
            data-bs-target="#syndication"
            type="button"
            role="tab"
          >
            <i class="fas fa-share-alt me-2"></i>
            Syndication
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="autonomous-tab"
            data-bs-toggle="tab"
            data-bs-target="#autonomous"
            type="button"
            role="tab"
          >
            <i class="fas fa-robot me-2"></i>
            Autonomous
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="actions-tab"
            data-bs-toggle="tab"
            data-bs-target="#actions"
            type="button"
            role="tab"
          >
            <i class="fas fa-bolt me-2"></i>
            Actions
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="system-integrity-tab"
            data-bs-toggle="tab"
            data-bs-target="#system-integrity"
            type="button"
            role="tab"
          >
            <i class="fas fa-shield-alt me-2"></i>
            System Integrity
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content" id="controlTabsContent">
        <!-- Channels Tab -->
        <div class="tab-pane fade show active" id="channels" role="tabpanel">
          <div class="control-panel">
            <h4>
              <i class="fas fa-broadcast-tower me-2"></i>
              Content Channels
            </h4>
            <p class="text-muted">Manage content distribution across platforms</p>
            <div id="channels-toggles"></div>
          </div>
        </div>

        <!-- Monetization Tab -->
        <div class="tab-pane fade" id="monetization" role="tabpanel">
          <div class="control-panel">
            <h4>
              <i class="fas fa-dollar-sign me-2"></i>
              Monetization Systems
            </h4>
            <p class="text-muted">Revenue generation and affiliate programs</p>
            <div id="monetization-toggles"></div>
          </div>
        </div>

        <!-- Syndication Tab -->
        <div class="tab-pane fade" id="syndication" role="tabpanel">
          <div class="control-panel">
            <h4>
              <i class="fas fa-share-alt me-2"></i>
              Content Syndication
            </h4>
            <p class="text-muted">Automated content distribution and cross-posting</p>
            <div id="syndication-toggles"></div>
          </div>
        </div>

        <!-- Autonomous Tab -->
        <div class="tab-pane fade" id="autonomous" role="tabpanel">
          <div class="control-panel">
            <h4>
              <i class="fas fa-robot me-2"></i>
              Autonomous Directives
            </h4>
            <p class="text-muted">AI-driven automation and decision making</p>
            <div id="autonomous-toggles"></div>
          </div>
        </div>

        <!-- Actions Tab -->
        <div class="tab-pane fade" id="actions" role="tabpanel">
          <div class="control-panel">
            <h4>
              <i class="fas fa-bolt me-2"></i>
              Dashboard Actions
            </h4>
            <p class="text-muted">Execute system actions and Max-Out operations</p>

            <!-- System Actions -->
            <div class="row mb-4">
              <div class="col-md-6">
                <div class="card">
                  <div class="card-header">
                    <h5>
                      <i class="fas fa-cogs me-2"></i>
                      System Actions
                    </h5>
                  </div>
                  <div class="card-body">
                    <div class="d-grid gap-2">
                      <button class="btn btn-primary" onclick="executeAction('system', 'restart_dashboard')">
                        <i class="fas fa-redo me-2"></i>
                        Restart Dashboard
                      </button>
                      <button class="btn btn-info" onclick="executeAction('system', 'health_check')">
                        <i class="fas fa-heartbeat me-2"></i>
                        Health Check
                      </button>
                      <button class="btn btn-warning" onclick="executeAction('system', 'clear_cache')">
                        <i class="fas fa-trash me-2"></i>
                        Clear Cache
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card">
                  <div class="card-header">
                    <h5>
                      <i class="fas fa-rocket me-2"></i>
                      Max-Out Actions
                    </h5>
                  </div>
                  <div class="card-body">
                    <div class="d-grid gap-2">
                      <button class="btn btn-success" onclick="executeAction('maxout', 'run_one_channel')">
                        <i class="fas fa-play me-2"></i>
                        Run One Channel
                      </button>
                      <button class="btn btn-primary" onclick="executeAction('maxout', 'optimize_content')">
                        <i class="fas fa-chart-line me-2"></i>
                        Optimize Content
                      </button>
                      <button class="btn btn-info" onclick="executeAction('maxout', 'analyze_performance')">
                        <i class="fas fa-analytics me-2"></i>
                        Analyze Performance
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Action Status -->
            <div class="card" id="action-status-card" style="display: none">
              <div class="card-header">
                <h5>
                  <i class="fas fa-tasks me-2"></i>
                  Action Status
                </h5>
              </div>
              <div class="card-body">
                <div id="action-status-content"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- System Integrity Tab -->
        <div class="tab-pane fade" id="system-integrity" role="tabpanel">
          <div class="control-panel">
            <h4>
              <i class="fas fa-shield-alt me-2"></i>
              System Integrity & Go-Live
            </h4>
            <p class="text-muted">Comprehensive automated testing and production readiness verification</p>

            <!-- Smoke Test Controls -->
            <div class="row mb-4">
              <div class="col-md-8">
                <div class="card">
                  <div class="card-header">
                    <h5>
                      <i class="fas fa-vial me-2"></i>
                      Automated Smoke Test
                    </h5>
                  </div>
                  <div class="card-body">
                    <p class="mb-3">
                      Run comprehensive pre-flight checks and live system verification (5-minute protocol)
                    </p>
                    <div class="d-flex gap-3 align-items-center">
                      <button id="run-smoke-test" class="btn btn-success" onclick="runSmokeTest()">
                        <i class="fas fa-play me-2"></i>
                        Run Complete Smoke Test
                      </button>
                      <button id="stop-smoke-test" class="btn btn-danger" onclick="stopSmokeTest()" disabled>
                        <i class="fas fa-stop me-2"></i>
                        Stop Test
                      </button>
                      <div class="ms-auto">
                        <span id="test-status" class="badge bg-secondary">Ready</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card">
                  <div class="card-header">
                    <h6>
                      <i class="fas fa-info-circle me-2"></i>
                      Test Overview
                    </h6>
                  </div>
                  <div class="card-body">
                    <ul class="list-unstyled mb-0">
                      <li>
                        <i class="fas fa-check-circle text-muted me-2"></i>
                        Pre-flight Checks
                      </li>
                      <li>
                        <i class="fas fa-check-circle text-muted me-2"></i>
                        Health Endpoints
                      </li>
                      <li>
                        <i class="fas fa-check-circle text-muted me-2"></i>
                        Video Task Creation
                      </li>
                      <li>
                        <i class="fas fa-check-circle text-muted me-2"></i>
                        File Verification
                      </li>
                      <li>
                        <i class="fas fa-check-circle text-muted me-2"></i>
                        System Resources
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <!-- Test Progress -->
            <div class="card mb-4" id="test-progress-card" style="display: none">
              <div class="card-header">
                <h5>
                  <i class="fas fa-tasks me-2"></i>
                  Test Progress
                </h5>
              </div>
              <div class="card-body">
                <div class="progress mb-3">
                  <div id="test-progress-bar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                </div>
                <div id="current-test-step" class="mb-2">Initializing...</div>
                <div id="test-timer" class="text-muted">Elapsed: 00:00</div>
              </div>
            </div>

            <!-- Test Results -->
            <div class="card" id="test-results-card" style="display: none">
              <div class="card-header">
                <h5>
                  <i class="fas fa-clipboard-list me-2"></i>
                  Test Results
                </h5>
              </div>
              <div class="card-body">
                <div id="test-results-content"></div>
              </div>
            </div>

            <!-- Live Test Log -->
            <div class="card mt-4" id="test-log-card" style="display: none">
              <div class="card-header">
                <h5>
                  <i class="fas fa-terminal me-2"></i>
                  Live Test Log
                </h5>
              </div>
              <div class="card-body">
                <div
                  id="test-log"
                  class="bg-dark text-light p-3"
                  style="height: 300px; overflow-y: auto; font-family: monospace; font-size: 0.9em"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Status Dashboard -->
      <div class="row mt-4">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h5>
                <i class="fas fa-chart-line me-2"></i>
                System Status
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-6">
                  <div class="text-center">
                    <h3 class="text-success" id="active-channels">0</h3>
                    <small class="text-muted">Active Channels</small>
                  </div>
                </div>
                <div class="col-6">
                  <div class="text-center">
                    <h3 class="text-info" id="active-monetization">0</h3>
                    <small class="text-muted">Revenue Streams</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h5>
                <i class="fas fa-cogs me-2"></i>
                Automation Status
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-6">
                  <div class="text-center">
                    <h3 class="text-warning" id="active-syndication">0</h3>
                    <small class="text-muted">Syndication Rules</small>
                  </div>
                </div>
                <div class="col-6">
                  <div class="text-center">
                    <h3 class="text-primary" id="active-autonomous">0</h3>
                    <small class="text-muted">AI Directives</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let config = {};//Load configuration on page load
      document.addEventListener('DOMContentLoaded', function () {
        loadConfiguration();
      });

      async function loadConfiguration() {
        try {
          const response = await fetch("/api/config');
          const data = await response.json();
          config = data;//Update master toggles
          document.getElementById('go_live').checked = config.go_live || false;
          document.getElementById('master_automation').checked = config.master_automation || false;//Render category toggles
          renderToggles('channels', config.channels?.toggles || {});
          renderToggles('monetization', config.monetization?.toggles || {});
          renderToggles('syndication', config.syndication?.toggles || {});
          renderToggles('autonomous', config.autonomous_directives?.toggles || {});//Update status counters
          updateStatusCounters();
        } catch (error) {
          console.error('Failed to load configuration:', error);
        }
      }

      function renderToggles(category, toggles) {
        const container = document.getElementById(`${category}-toggles`);
        container.innerHTML = '';

        Object.entries(toggles).forEach(([key, toggle]) => {
          const toggleHtml = `
                    <div class="toggle-item">
                        <div class="toggle-info">
                            <div class="toggle-title">${toggle.name}</div>
                            <div class="toggle-description">${toggle.description}</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" ${toggle.enabled ? 'checked' : ''} 
                                   onchange="updateToggle('${category}', '${key}', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                `;
          container.innerHTML += toggleHtml;
        });
      }

      async function updateToggle(category, key, enabled) {
        try {
          const response = await fetch("/api/config/toggle', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              category: category,
              key: key,
              enabled: enabled,
            }),
          });

          const result = await response.json();
          if (result.success) {//Update local config
            if (config[category] && config[category].toggles && config[category].toggles[key]) {
              config[category].toggles[key].enabled = enabled;
            }
            updateStatusCounters();
            console.log(`Toggle updated: ${category}.${key} = ${enabled}`);
          } else {
            console.error('Failed to update toggle:', result.error);
          }
        } catch (error) {
          console.error('Error updating toggle:', error);
        }
      }

      async function updateMasterToggle(key, enabled) {
        try {
          const updateData = {};
          updateData[key] = enabled;

          const response = await fetch("/api/config/update', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(updateData),
          });

          const result = await response.json();
          if (result.success) {
            config[key] = enabled;
            console.log(`Master toggle updated: ${key} = ${enabled}`);
          } else {
            console.error('Failed to update master toggle:', result.error);
          }
        } catch (error) {
          console.error('Error updating master toggle:', error);
        }
      }

      function updateStatusCounters() {
        let activeChannels = 0;
        let activeMonetization = 0;
        let activeSyndication = 0;
        let activeAutonomous = 0;//Count active toggles in each category
        if (config.channels?.toggles) {
          activeChannels = Object.values(config.channels.toggles).filter(t => t.enabled).length;
        }
        if (config.monetization?.toggles) {
          activeMonetization = Object.values(config.monetization.toggles).filter(t => t.enabled).length;
        }
        if (config.syndication?.toggles) {
          activeSyndication = Object.values(config.syndication.toggles).filter(t => t.enabled).length;
        }
        if (config.autonomous_directives?.toggles) {
          activeAutonomous = Object.values(config.autonomous_directives.toggles).filter(t => t.enabled).length;
        }//Update counters
        document.getElementById('active-channels').textContent = activeChannels;
        document.getElementById('active-monetization').textContent = activeMonetization;
        document.getElementById('active-syndication').textContent = activeSyndication;
        document.getElementById('active-autonomous').textContent = activeAutonomous;
      }//Smoke Test Functions
      let smokeTestInterval = null;
      let testStartTime = null;
      let currentTestSession = null;

      async function runSmokeTest() {
        try {//Update UI state
          document.getElementById('run-smoke-test').disabled = true;
          document.getElementById('stop-smoke-test').disabled = false;
          document.getElementById('test-status').className = 'badge bg-warning';
          document.getElementById('test-status').textContent = 'Running';//Show progress and log cards
          document.getElementById('test-progress-card').style.display = 'block';
          document.getElementById('test-log-card').style.display = 'block';
          document.getElementById('test-results-card').style.display = 'none';//Clear previous results
          document.getElementById('test-log').innerHTML = '';
          document.getElementById('test-progress-bar').style.width = '0%';
          document.getElementById('current-test-step').textContent = 'Initializing smoke test...';//Start timer
          testStartTime = Date.now();
          smokeTestInterval = setInterval(updateTestTimer, 1000);//Start the smoke test
          const response = await fetch("/api/smoke-test/run', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
          });

          const result = await response.json();
          if (result.success) {
            currentTestSession = result.session_id;
            addTestLog('✓ Smoke test started successfully');
            addTestLog(`Session ID: ${currentTestSession}`);//Start polling for updates
            pollTestStatus();
          } else {
            throw new Error(result.error || 'Failed to start smoke test');
          }
        } catch (error) {
          console.error('Error starting smoke test:', error);
          addTestLog(`✗ Error: ${error.message}`);
          resetTestUI();
        }
      }

      async function stopSmokeTest() {
        if (!currentTestSession) return;

        try {
          const response = await fetch("/api/smoke-test/stop', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ session_id: currentTestSession }),
          });

          const result = await response.json();
          if (result.success) {
            addTestLog('✓ Smoke test stopped by user');
          } else {
            addTestLog(`✗ Error stopping test: ${result.error}`);
          }
        } catch (error) {
          console.error('Error stopping smoke test:', error);
          addTestLog(`✗ Error stopping test: ${error.message}`);
        }

        resetTestUI();
      }

      async function pollTestStatus() {
        if (!currentTestSession) return;

        try {
          const response = await fetch(`/api/smoke-test/status/${currentTestSession}`);
          const status = await response.json();

          if (status.success) {
            updateTestProgress(status.data);//Continue polling if test is still running
            if (status.data.status === 'running') {
              setTimeout(pollTestStatus, 2000);//Poll every 2 seconds
            } else {//Test completed
              handleTestCompletion(status.data);
            }
          } else {
            addTestLog(`✗ Error getting test status: ${status.error}`);
            resetTestUI();
          }
        } catch (error) {
          console.error('Error polling test status:', error);
          addTestLog(`✗ Error polling status: ${error.message}`);
          resetTestUI();
        }
      }

      function updateTestProgress(testData) {//Update progress bar
        const progress = testData.progress || 0;
        document.getElementById('test-progress-bar').style.width = `${progress}%`;//Update current step
        if (testData.current_step) {
          document.getElementById('current-test-step').textContent = testData.current_step;
        }//Add new log entries
        if (testData.recent_logs) {
          testData.recent_logs.forEach(log => {
            addTestLog(log);
          });
        }
      }

      function handleTestCompletion(testData) {//Update status badge
        const success = testData.status === 'completed' && testData.success;
        document.getElementById('test-status').className = success ? 'badge bg-success' : 'badge bg-danger';
        document.getElementById('test-status').textContent = success ? 'Passed' : 'Failed';//Show results
        document.getElementById('test-results-card').style.display = 'block';
        displayTestResults(testData);//Final log entry
        const duration = Math.round((Date.now() - testStartTime)/1000);
        addTestLog(`\n=== Test ${success ? 'PASSED' : 'FAILED'} in ${duration}s ===`);

        resetTestUI();
      }

      function displayTestResults(testData) {
        const resultsContainer = document.getElementById('test-results-content');
        let html = '';

        if (testData.results) {
          testData.results.forEach(result => {
            const statusIcon = result.success ? '✓' : '✗';
            const statusClass = result.success ? 'text-success' : 'text-danger';

            html += `
                        <div class="mb-3">
                            <h6><span class="${statusClass}">${statusIcon}</span> ${result.test_name}</h6>
                            <p class="mb-1">${result.message}</p>
                            ${result.details ? `<small class="text-muted">${result.details}</small>` : ''}
                        </div>
                    `;
          });
        }

        if (testData.summary) {
          html += `
                    <div class="mt-4 p-3 bg-light rounded">
                        <h6>Summary</h6>
                        <p class="mb-0">${testData.summary}</p>
                    </div>
                `;
        }

        resultsContainer.innerHTML = html;
      }

      function addTestLog(message) {
        const logContainer = document.getElementById('test-log');
        const timestamp = new Date().toLocaleTimeString();
        logContainer.innerHTML += `[${timestamp}] ${message}\n`;
        logContainer.scrollTop = logContainer.scrollHeight;
      }

      function updateTestTimer() {
        if (!testStartTime) return;

        const elapsed = Math.floor((Date.now() - testStartTime)/1000);
        const minutes = Math.floor(elapsed/60);
        const seconds = elapsed % 60;

        document.getElementById('test-timer').textContent =
          `Elapsed: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      }

      function resetTestUI() {//Reset buttons
        document.getElementById('run-smoke-test').disabled = false;
        document.getElementById('stop-smoke-test').disabled = true;//Clear intervals
        if (smokeTestInterval) {
          clearInterval(smokeTestInterval);
          smokeTestInterval = null;
        }//Reset variables
        testStartTime = null;
        currentTestSession = null;
      }//Actions system functions
      async function executeAction(agent, action) {
        const statusCard = document.getElementById('action-status-card');
        const statusContent = document.getElementById('action-status-content');//Show status card
        statusCard.style.display = 'block';
        statusContent.innerHTML = `
                <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                    <span>Executing ${agent}/${action}...</span>
                </div>
            `;

        try {
          const response = await fetch(`/api/action/${agent}/${action}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({}),
          });

          const result = await response.json();

          if (result.ok) {
            statusContent.innerHTML = `
                        <div class="alert alert-success mb-0">
                            <i class="fas fa-check-circle me-2"></i>
                            <strong>Success:</strong> ${agent}/${action} executed successfully
                            ${result.result ? `<br><small class="text-muted">Result: ${JSON.stringify(result.result)}</small>` : ''}
                        </div>
                    `;
          } else {
            statusContent.innerHTML = `
                        <div class="alert alert-danger mb-0">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            <strong>Error:</strong> ${result.error || 'Unknown error'}
                        </div>
                    `;
          }
        } catch (error) {
          statusContent.innerHTML = `
                    <div class="alert alert-danger mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Network Error:</strong> ${error.message}
                    </div>
                `;
        }//Auto-hide after 5 seconds
        setTimeout(() => {
          statusCard.style.display = 'none';
        }, 5000);
      }
    </script>
  </body>
</html>
