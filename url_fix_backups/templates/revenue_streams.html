<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revenue Streams Management - TRAE.AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .revenue-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .revenue-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .revenue-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .revenue-card.active {
            border: 3px solid #4CAF50;
        }

        .revenue-card.inactive {
            opacity: 0.7;
            border: 3px solid #f44336;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .stream-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #333;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ccc;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #4CAF50;
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }

        .revenue-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-warning {
            background: #ff9800;
            color: white;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .status-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #f44336;
        }

        .status-indicator.active {
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .global-controls {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .total-revenue {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4CAF50;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2rem;
            cursor: pointer;
            color: #999;
        }

        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }

        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .test-item:last-child {
            border-bottom: none;
        }

        .test-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .test-status.pass {
            background: #4CAF50;
            color: white;
        }

        .test-status.fail {
            background: #f44336;
            color: white;
        }

        .test-status.pending {
            background: #ff9800;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Revenue Streams Management</h1>
            <p>Individual Income Lines - Production Ready Monetization</p>
        </div>

        <div class="global-controls">
            <div class="control-row">
                <div>
                    <h2>Total Monthly Revenue</h2>
                    <div class="total-revenue" id="totalRevenue">$0</div>
                </div>
                <div>
                    <button class="btn btn-success" onclick="startAllStreams()">Start All Active</button>
                    <button class="btn btn-danger" onclick="stopAllStreams()">Stop All</button>
                    <button class="btn btn-warning" onclick="runGlobalTests()">Test All Systems</button>
                </div>
            </div>
        </div>

        <div class="revenue-grid" id="revenueGrid">
            <!-- Revenue stream cards will be populated by JavaScript -->
        </div>
    </div>

    <!-- Modal for stream configuration -->
    <div id="configModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Configure Revenue Stream</h2>
            <div id="modalContent">
                <!-- Dynamic content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Modal for test results -->
    <div id="testModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeTestModal()">&times;</span>
            <h2>System Test Results</h2>
            <div id="testResults">
                <!-- Test results will be displayed here -->
            </div>
        </div>
    </div>

    <script>
        // Revenue stream configurations
        const revenueStreams = {
            youtube_ads: {
                name: 'YouTube Ad Revenue',
                description: 'Monetize video content through YouTube Partner Program',
                monthlyTarget: 5000,
                currentRevenue: 0,
                isActive: false,
                autoStart: false,
                testEndpoints: ['/api/youtube/auth', '/api/youtube/analytics', '/api/youtube/monetization']
            },
            affiliate_marketing: {
                name: 'Affiliate Marketing',
                description: 'Commission-based product recommendations',
                monthlyTarget: 8000,
                currentRevenue: 0,
                isActive: false,
                autoStart: false,
                testEndpoints: ['/api/affiliate/programs', '/api/affiliate/tracking', '/api/affiliate/payouts']
            },
            digital_products: {
                name: 'Digital Products',
                description: 'eBooks, courses, and digital downloads',
                monthlyTarget: 12000,
                currentRevenue: 0,
                isActive: false,
                autoStart: false,
                testEndpoints: ['/api/products/catalog', '/api/products/payments', '/api/products/delivery']
            },
            merchandise: {
                name: 'Merchandise Sales',
                description: 'Physical products and branded items',
                monthlyTarget: 6000,
                currentRevenue: 0,
                isActive: false,
                autoStart: false,
                testEndpoints: ['/api/merch/inventory', '/api/merch/orders', '/api/merch/fulfillment']
            },
            newsletter: {
                name: 'Newsletter Monetization',
                description: 'Paid subscriptions and sponsored content',
                monthlyTarget: 4000,
                currentRevenue: 0,
                isActive: false,
                autoStart: false,
                testEndpoints: ['/api/newsletter/subscribers', '/api/newsletter/campaigns', '/api/newsletter/analytics']
            },
            sponsored_content: {
                name: 'Sponsored Content',
                description: 'Brand partnerships and sponsored posts',
                monthlyTarget: 10000,
                currentRevenue: 0,
                isActive: false,
                autoStart: false,
                testEndpoints: ['/api/sponsors/campaigns', '/api/sponsors/tracking', '/api/sponsors/payments']
            },
            membership: {
                name: 'Membership Program',
                description: 'Premium subscriptions and exclusive content',
                monthlyTarget: 15000,
                currentRevenue: 0,
                isActive: false,
                autoStart: false,
                testEndpoints: ['/api/membership/tiers', '/api/membership/billing', '/api/membership/content']
            },
            consulting: {
                name: 'Consulting Services',
                description: 'One-on-one and group consulting sessions',
                monthlyTarget: 20000,
                currentRevenue: 0,
                isActive: false,
                autoStart: false,
                testEndpoints: ['/api/consulting/bookings', '/api/consulting/payments', '/api/consulting/calendar']
            },
            software_tools: {
                name: 'Software Tools',
                description: 'SaaS products and software licensing',
                monthlyTarget: 25000,
                currentRevenue: 0,
                isActive: false,
                autoStart: false,
                testEndpoints: ['/api/software/licensing', '/api/software/usage', '/api/software/billing']
            },
            live_events: {
                name: 'Live Events & Webinars',
                description: 'Paid workshops, seminars, and online events',
                monthlyTarget: 8000,
                currentRevenue: 0,
                isActive: false,
                autoStart: false,
                testEndpoints: ['/api/events/registration', '/api/events/streaming', '/api/events/payments']
            }
        };

        // Initialize the revenue streams display
        function initializeRevenueStreams() {
            const grid = document.getElementById('revenueGrid');
            grid.innerHTML = '';

            Object.keys(revenueStreams).forEach(streamId => {
                const stream = revenueStreams[streamId];
                const card = createRevenueCard(streamId, stream);
                grid.appendChild(card);
            });

            updateTotalRevenue();
        }

        // Create individual revenue stream card
        function createRevenueCard(streamId, stream) {
            const card = document.createElement('div');
            card.className = `revenue-card ${stream.isActive ? 'active' : 'inactive'}`;
            card.innerHTML = `
                <div class="status-indicator ${stream.isActive ? 'active' : ''}"></div>
                <div class="card-header">
                    <h3 class="stream-title">${stream.name}</h3>
                    <div class="toggle-switch ${stream.isActive ? 'active' : ''}" onclick="toggleStream('${streamId}')">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <p style="color: #666; margin-bottom: 20px;">${stream.description}</p>
                <div class="revenue-stats">
                    <div class="stat-item">
                        <div class="stat-value">$${stream.currentRevenue.toLocaleString()}</div>
                        <div class="stat-label">Current Revenue</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">$${stream.monthlyTarget.toLocaleString()}</div>
                        <div class="stat-label">Monthly Target</div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="configureStream('${streamId}')">Configure</button>
                    <button class="btn btn-warning" onclick="testStream('${streamId}')">Test</button>
                    <button class="btn ${stream.isActive ? 'btn-danger' : 'btn-success'}" onclick="${stream.isActive ? 'stopStream' : 'startStream'}('${streamId}')">
                        ${stream.isActive ? 'Stop' : 'Start'}
                    </button>
                </div>
            `;
            return card;
        }

        // Toggle stream on/off
        function toggleStream(streamId) {
            const stream = revenueStreams[streamId];
            stream.isActive = !stream.isActive;

            if (stream.isActive) {
                startStream(streamId);
            } else {
                stopStream(streamId);
            }

            initializeRevenueStreams();
        }

        // Start individual stream
        async function startStream(streamId) {
            const stream = revenueStreams[streamId];
            console.log(`Starting ${stream.name}...`);

            try {
                const response = await fetch(`/api/revenue/start/${streamId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ autoStart: stream.autoStart })
                });

                if (response.ok) {
                    stream.isActive = true;
                    showNotification(`${stream.name} started successfully!`, 'success');
                } else {
                    throw new Error('Failed to start stream');
                }
            } catch (error) {
                console.error(`Error starting ${stream.name}:`, error);
                showNotification(`Failed to start ${stream.name}`, 'error');
            }

            initializeRevenueStreams();
        }

        // Stop individual stream
        async function stopStream(streamId) {
            const stream = revenueStreams[streamId];
            console.log(`Stopping ${stream.name}...`);

            try {
                const response = await fetch(`/api/revenue/stop/${streamId}`, {
                    method: 'POST'
                });

                if (response.ok) {
                    stream.isActive = false;
                    showNotification(`${stream.name} stopped successfully!`, 'success');
                } else {
                    throw new Error('Failed to stop stream');
                }
            } catch (error) {
                console.error(`Error stopping ${stream.name}:`, error);
                showNotification(`Failed to stop ${stream.name}`, 'error');
            }

            initializeRevenueStreams();
        }

        // Test individual stream
        async function testStream(streamId) {
            const stream = revenueStreams[streamId];
            console.log(`Testing ${stream.name}...`);

            try {
                const response = await fetch(`/api/revenue/test/${streamId}`, {
                    method: 'POST'
                });

                const results = await response.json();
                showTestResults(stream.name, results);
            } catch (error) {
                console.error(`Error testing ${stream.name}:`, error);
                showNotification(`Failed to test ${stream.name}`, 'error');
            }
        }

        // Configure stream settings
        function configureStream(streamId) {
            const stream = revenueStreams[streamId];
            document.getElementById('modalTitle').textContent = `Configure ${stream.name}`;

            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <label>Monthly Target ($)</label>
                    <input type="number" id="monthlyTarget" value="${stream.monthlyTarget}" style="width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label>
                        <input type="checkbox" id="autoStart" ${stream.autoStart ? 'checked' : ''}>
                        Auto-start when system boots
                    </label>
                </div>
                <div style="margin-bottom: 20px;">
                    <h4>Test Endpoints:</h4>
                    <ul>
                        ${stream.testEndpoints.map(endpoint => `<li>${endpoint}</li>`).join('')}
                    </ul>
                </div>
                <button class="btn btn-success" onclick="saveStreamConfig('${streamId}')">Save Configuration</button>
            `;

            document.getElementById('configModal').style.display = 'block';
        }

        // Save stream configuration
        function saveStreamConfig(streamId) {
            const stream = revenueStreams[streamId];
            stream.monthlyTarget = parseInt(document.getElementById('monthlyTarget').value);
            stream.autoStart = document.getElementById('autoStart').checked;

            // Save to backend
            fetch(`/api/revenue/config/${streamId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    monthlyTarget: stream.monthlyTarget,
                    autoStart: stream.autoStart
                })
            });

            closeModal();
            initializeRevenueStreams();
            showNotification('Configuration saved successfully!', 'success');
        }

        // Start all active streams
        async function startAllStreams() {
            const activeStreams = Object.keys(revenueStreams).filter(id => revenueStreams[id].autoStart);

            for (const streamId of activeStreams) {
                await startStream(streamId);
            }

            showNotification(`Started ${activeStreams.length} revenue streams`, 'success');
        }

        // Stop all streams
        async function stopAllStreams() {
            const activeStreams = Object.keys(revenueStreams).filter(id => revenueStreams[id].isActive);

            for (const streamId of activeStreams) {
                await stopStream(streamId);
            }

            showNotification(`Stopped ${activeStreams.length} revenue streams`, 'success');
        }

        // Run comprehensive tests on all systems
        async function runGlobalTests() {
            console.log('Running global system tests...');

            try {
                const response = await fetch('/api/revenue/test/all', {
                    method: 'POST'
                });

                const results = await response.json();
                showTestResults('All Systems', results);
            } catch (error) {
                console.error('Error running global tests:', error);
                showNotification('Failed to run global tests', 'error');
            }
        }

        // Show test results modal
        function showTestResults(systemName, results) {
            const testResults = document.getElementById('testResults');
            testResults.innerHTML = `
                <h3>${systemName} Test Results</h3>
                <div class="test-results">
                    ${Object.keys(results).map(testName => `
                        <div class="test-item">
                            <span>${testName}</span>
                            <span class="test-status ${results[testName].status}">${results[testName].status.toUpperCase()}</span>
                        </div>
                    `).join('')}
                </div>
            `;

            document.getElementById('testModal').style.display = 'block';
        }

        // Update total revenue display
        function updateTotalRevenue() {
            const total = Object.values(revenueStreams).reduce((sum, stream) => sum + stream.currentRevenue, 0);
            document.getElementById('totalRevenue').textContent = `$${total.toLocaleString()}`;
        }

        // Show notification
        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                background: ${type === 'success' ? '#4CAF50' : '#f44336'};
                color: white;
                border-radius: 5px;
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Modal functions
        function closeModal() {
            document.getElementById('configModal').style.display = 'none';
        }

        function closeTestModal() {
            document.getElementById('testModal').style.display = 'none';
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeRevenueStreams();

            // Auto-start streams that are configured for auto-start
            Object.keys(revenueStreams).forEach(streamId => {
                if (revenueStreams[streamId].autoStart) {
                    startStream(streamId);
                }
            });

            // Refresh revenue data every 30 seconds
            setInterval(updateRevenueData, 30000);
        });

        // Update revenue data from backend
        async function updateRevenueData() {
            try {
                const response = await fetch('/api/revenue/status');
                const data = await response.json();

                Object.keys(data.streams).forEach(streamId => {
                    if (revenueStreams[streamId]) {
                        revenueStreams[streamId].currentRevenue = data.streams[streamId].currentRevenue;
                        revenueStreams[streamId].isActive = data.streams[streamId].isActive;
                    }
                });

                initializeRevenueStreams();
            } catch (error) {
                console.error('Error updating revenue data:', error);
            }
        }
    </script>
</body>
</html>
