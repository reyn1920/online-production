<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Discovery & Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #2d3748;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #718096;
            font-size: 1.1rem;
        }

        .search-section {
            background: #f7fafc;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e2e8f0;
        }

        .search-controls {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 15px;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .form-group select,
        .form-group input {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #718096;
            font-weight: 500;
        }

        .results-section {
            margin-top: 30px;
        }

        .channel-group {
            margin-bottom: 30px;
        }

        .channel-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
        }

        .channel-icon {
            font-size: 1.5rem;
        }

        .channel-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .api-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .api-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
            position: relative;
        }

        .api-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .api-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .api-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .api-category {
            background: #edf2f7;
            color: #4a5568;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .cost-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .cost-free {
            background: #c6f6d5;
            color: #22543d;
        }

        .cost-freemium {
            background: #bee3f8;
            color: #2a4365;
        }

        .cost-paid {
            background: #fed7d7;
            color: #742a2a;
        }

        .cost-unknown {
            background: #e2e8f0;
            color: #4a5568;
        }

        .api-description {
            color: #718096;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .api-features {
            margin-bottom: 15px;
        }

        .feature-tag {
            display: inline-block;
            background: #f0f4f8;
            color: #2d3748;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            margin: 2px;
        }

        .api-score {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .score-bar {
            flex: 1;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            transition: width 0.3s ease;
        }

        .score-text {
            font-weight: 600;
            color: #2d3748;
        }

        .api-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .empty-state h3 {
            color: #4a5568;
            margin-bottom: 10px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #48bb78;
        }

        .notification.error {
            background: #f56565;
        }

        @media (max-width: 768px) {
            .search-controls {
                grid-template-columns: 1fr;
            }
            
            .api-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç API Discovery & Management</h1>
            <p>Discover and manage the best APIs for your marketing channels</p>
        </div>

        <div class="search-section">
            <div class="search-controls">
                <div class="form-group">
                    <label for="channelSelect">Marketing Channel</label>
                    <select id="channelSelect">
                        <option value="">All Channels</option>
                        <option value="youtube">üì∫ YouTube</option>
                        <option value="tiktok">üéµ TikTok</option>
                        <option value="instagram">üì∏ Instagram</option>
                        <option value="twitter">üê¶ Twitter/X</option>
                        <option value="affiliate">ü§ù Affiliate Marketing</option>
                        <option value="email">üìß Email Marketing</option>
                        <option value="analytics">üìä Analytics</option>
                        <option value="content">üé® Content Creation</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="discoverAPIs()">
                    üîç Discover APIs
                </button>
                <button class="btn btn-secondary" onclick="showFreeAPIs()">
                    üíö Free APIs Only
                </button>
            </div>
        </div>

        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-number" id="totalAPIs">0</div>
                <div class="stat-label">Total APIs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="freeAPIs">0</div>
                <div class="stat-label">Free APIs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="channels">8</div>
                <div class="stat-label">Channels</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgScore">0.0</div>
                <div class="stat-label">Avg Score</div>
            </div>
        </div>

        <div class="results-section" id="resultsSection">
            <div class="empty-state">
                <h3>Ready to discover APIs</h3>
                <p>Select a channel and click "Discover APIs" to find the best integrations for your marketing needs.</p>
            </div>
        </div>
    </div>

    <script>
        let discoveredAPIs = {};
        let allAPIs = [];

        // Channel icons mapping
        const channelIcons = {
            youtube: 'üì∫',
            tiktok: 'üéµ',
            instagram: 'üì∏',
            twitter: 'üê¶',
            affiliate: 'ü§ù',
            email: 'üìß',
            analytics: 'üìä',
            content: 'üé®'
        };

        async function discoverAPIs() {
            const channel = document.getElementById('channelSelect').value;
            const resultsSection = document.getElementById('resultsSection');
            
            // Show loading state
            resultsSection.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Discovering APIs${channel ? ` for ${channel}` : ' for all channels'}...</p>
                </div>
            `;

            try {
                const response = await fetch('/api/discover-apis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${getAuthToken()}`
                    },
                    body: JSON.stringify({ channel: channel || 'all' })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                discoveredAPIs = data.apis || {};
                allAPIs = Object.values(discoveredAPIs).flat();
                
                displayResults(discoveredAPIs);
                updateStats();
                showNotification('APIs discovered successfully!', 'success');
                
            } catch (error) {
                console.error('Error discovering APIs:', error);
                resultsSection.innerHTML = `
                    <div class="empty-state">
                        <h3>Error discovering APIs</h3>
                        <p>There was an error discovering APIs. Please try again.</p>
                    </div>
                `;
                showNotification('Error discovering APIs', 'error');
            }
        }

        async function showFreeAPIs() {
            const resultsSection = document.getElementById('resultsSection');
            
            resultsSection.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading free APIs...</p>
                </div>
            `;

            try {
                const response = await fetch('/api/free-apis', {
                    headers: {
                        'Authorization': `Bearer ${getAuthToken()}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                const freeAPIs = data.apis || [];
                
                // Group free APIs by channel
                const groupedAPIs = {};
                freeAPIs.forEach(api => {
                    if (!groupedAPIs[api.channel]) {
                        groupedAPIs[api.channel] = [];
                    }
                    groupedAPIs[api.channel].push(api);
                });
                
                displayResults(groupedAPIs);
                updateStats(freeAPIs);
                showNotification('Free APIs loaded successfully!', 'success');
                
            } catch (error) {
                console.error('Error loading free APIs:', error);
                resultsSection.innerHTML = `
                    <div class="empty-state">
                        <h3>Error loading free APIs</h3>
                        <p>There was an error loading free APIs. Please try again.</p>
                    </div>
                `;
                showNotification('Error loading free APIs', 'error');
            }
        }

        function displayResults(apisByChannel) {
            const resultsSection = document.getElementById('resultsSection');
            
            if (Object.keys(apisByChannel).length === 0) {
                resultsSection.innerHTML = `
                    <div class="empty-state">
                        <h3>No APIs found</h3>
                        <p>No APIs were discovered for the selected criteria.</p>
                    </div>
                `;
                return;
            }

            let html = '';
            
            Object.entries(apisByChannel).forEach(([channel, apis]) => {
                if (apis.length === 0) return;
                
                const icon = channelIcons[channel] || 'üîß';
                const channelName = channel.charAt(0).toUpperCase() + channel.slice(1);
                
                html += `
                    <div class="channel-group">
                        <div class="channel-header">
                            <span class="channel-icon">${icon}</span>
                            <span class="channel-title">${channelName}</span>
                            <span class="channel-count">(${apis.length} APIs)</span>
                        </div>
                        <div class="api-grid">
                `;
                
                apis.forEach(api => {
                    const features = Array.isArray(api.features) ? api.features : 
                                   (typeof api.features === 'string' ? JSON.parse(api.features || '[]') : []);
                    
                    html += createAPICard(api, features);
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            resultsSection.innerHTML = html;
        }

        function createAPICard(api, features) {
            const costClass = `cost-${api.cost_model || 'unknown'}`;
            const scorePercentage = ((api.score || 0) / 10) * 100;
            
            return `
                <div class="api-card">
                    <div class="api-header">
                        <div>
                            <div class="api-name">${api.name}</div>
                            <div class="api-category">${api.category || 'Other'}</div>
                        </div>
                        <div class="cost-badge ${costClass}">
                            ${api.cost_model || 'Unknown'}
                        </div>
                    </div>
                    
                    <div class="api-description">
                        ${api.description || 'No description available'}
                    </div>
                    
                    <div class="api-features">
                        ${features.map(feature => `<span class="feature-tag">${feature}</span>`).join('')}
                    </div>
                    
                    <div class="api-score">
                        <div class="score-bar">
                            <div class="score-fill" style="width: ${scorePercentage}%"></div>
                        </div>
                        <div class="score-text">${(api.score || 0).toFixed(1)}/10</div>
                    </div>
                    
                    <div class="api-actions">
                        <a href="${api.url}" target="_blank" class="btn btn-primary btn-small">
                            üìñ Docs
                        </a>
                        <a href="${api.signup_url}" target="_blank" class="btn btn-secondary btn-small">
                            üöÄ Sign Up
                        </a>
                    </div>
                </div>
            `;
        }

        function updateStats(customAPIs = null) {
            const apis = customAPIs || allAPIs;
            
            const totalAPIs = apis.length;
            const freeAPIs = apis.filter(api => 
                api.cost_model === 'free' || api.cost_model === 'freemium'
            ).length;
            
            const avgScore = totalAPIs > 0 ? 
                (apis.reduce((sum, api) => sum + (api.score || 0), 0) / totalAPIs).toFixed(1) : 
                '0.0';
            
            document.getElementById('totalAPIs').textContent = totalAPIs;
            document.getElementById('freeAPIs').textContent = freeAPIs;
            document.getElementById('avgScore').textContent = avgScore;
        }

        function getAuthToken() {
            // In a real implementation, get from secure storage
            return localStorage.getItem('auth_token') || 'demo-token';
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Hide and remove notification
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Load any existing data
            showFreeAPIs();
        });
    </script>
</body>
</html>